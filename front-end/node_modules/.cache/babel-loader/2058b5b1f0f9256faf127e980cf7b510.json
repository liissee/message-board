{"ast":null,"code":"import { createSlice } from '@reduxjs/toolkit';\nimport { ui } from 'reducers/ui';\nexport const messages = createSlice({\n  name: 'messages',\n  initialState: {\n    messages: []\n  },\n  reducers: {\n    setMessage: (state, action) => {\n      state.messages = action.payload;\n    },\n    setPostedMessage: (state, action) => {\n      // state.messages = action.payload\n      state.messages.push(action.payload);\n    },\n    deleteMessage: (state, action) => {\n      // Filter out all message but the message with matching id\n      state.messages = state.messages.filter(message => message._id !== action.payload);\n    },\n    editMessage: (state, action) => {\n      // To find the message we want to update (message data = action.payload)\n      // If message found, return the message with updated data\n      state.messages = state.messages.map(message => {\n        if (message._id === action.payload._id) {\n          return action.payload;\n        } else {\n          // Otherwhise return message as is\n          return message;\n        }\n      });\n    }\n  }\n}); //GET MESSAGES\n\nexport const fetchMessages = () => {\n  return dispatch => {\n    // dispatch(ui.actions.setLoading(true))\n    fetch('http://localhost:8080/messages').then(res => res.json()).then(json => {\n      console.log(json);\n\n      if (json.children.length > 0) {\n        const replies = function (json, root) {\n          const nestedMessages = {};\n          json.forEach(message => {\n            Object.assign(nestedMessages[message._id] = nestedMessages[message._id] || {}, message);\n            nestedMessages[message.parentId] = nestedMessages[message.parentId] || {};\n            nestedMessages[message.parentId].children = nestedMessages[message.parentId].children || [];\n            nestedMessages[message.parentId].children.push(nestedMessages[message._id]);\n          });\n          return nestedMessages[root].children;\n        }(json, null);\n\n        dispatch(messages.actions.setMessage(replies)); // dispatch(ui.actions.setLoading(false))\n\n        console.log(\"Array with children\", replies);\n      } else {\n        dispatch(messages.actions.setMessage(json)); // dispatch(ui.actions.setLoading(false))\n      }\n    });\n  };\n}; //POST MESSAGES\n\nexport const postMessages = ({\n  message,\n  author,\n  parentId\n}) => {\n  return dispatch => {\n    const accessToken = localStorage.getItem('accessToken');\n    dispatch(ui.actions.setLoading(true));\n    fetch(\"http://localhost:8080/messages\", {\n      method: \"POST\",\n      body: JSON.stringify({\n        message,\n        author,\n        parentId\n      }),\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: accessToken\n      }\n    }).then(res => res.json()).then(json => {\n      console.log(\"author\", author);\n      console.log(\"json post\", json);\n      dispatch(messages.actions.setPostedMessage(json)); // dispatch(messages.actions.setMessage(json));\n\n      dispatch(ui.actions.setLoading(false));\n    }).catch(() => {\n      console.log(\"Failed to post message\");\n    });\n  };\n}; // //POST MESSAGES\n// export const postMessages = ({ message, author, parentId }) => {\n//   return dispatch => {\n//     const accessToken = localStorage.getItem('accessToken')\n//     // dispatch(ui.actions.setLoading(true))\n//     fetch(\"http://localhost:8080/messages\", {\n//       method: \"POST\",\n//       body: JSON.stringify({ message, author, parentId }),\n//       headers: {\n//         \"Content-Type\": \"application/json\",\n//         Authorization: accessToken\n//       }\n//     })\n//       .then(res => {\n//         console.log(\"author\", author)\n//         dispatch(messages.actions.setPostedMessage(message, author, parentId));\n//         // dispatch(messages.actions.setMessage(message));\n//         dispatch(ui.actions.setLoading(false))\n//       })\n//       .catch(() => {\n//         console.log(\"Failed to post message\")\n//       })\n//   }\n// };\n// DELETE MESSAGE\n\nexport const deleteMessages = ({\n  id,\n  author\n}) => {\n  return dispatch => {\n    dispatch(ui.actions.setLoading(true));\n    const accessToken = localStorage.getItem('accessToken');\n    const userId = localStorage.getItem('userId');\n    fetch(`http://localhost:8080/messages/${id}`, {\n      method: 'DELETE',\n      statusCode: 204,\n      body: JSON.stringify({\n        id,\n        author,\n        userId\n      }),\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: accessToken\n      }\n    }).then(() => {\n      if (author === userId) {\n        dispatch(messages.actions.deleteMessage(id));\n        dispatch(ui.actions.setLoading(false));\n        dispatch(ui.actions.setErrorMessage(false));\n      } else {\n        console.log(\"not your message\");\n        dispatch(ui.actions.setLoading(false));\n        dispatch(ui.actions.setErrorMessage(true));\n      }\n    });\n  };\n}; //EDIT MESSAGE\n\nexport const editMessages = ({\n  id,\n  author,\n  newValue\n}) => {\n  return dispatch => {\n    dispatch(ui.actions.setLoading(true));\n    const accessToken = localStorage.getItem('accessToken');\n    const userId = localStorage.getItem('userId');\n    fetch(`http://localhost:8080/messages/${id}`, {\n      method: 'PUT',\n      body: JSON.stringify({\n        message: newValue,\n        userId: userId,\n        author: author\n      }),\n      headers: {\n        'Content-Type': 'application/json',\n        Authorization: accessToken\n      }\n    }).then(res => res.json()).then(updatedMessage => {\n      console.log(\"2\", updatedMessage);\n      dispatch(messages.actions.editMessage(updatedMessage));\n      dispatch(ui.actions.setLoading(false));\n    });\n  };\n};","map":{"version":3,"sources":["/Users/lindaisell/Desktop/technigo-bootcamp/message-board/front-end/src/reducers/messages.js"],"names":["createSlice","ui","messages","name","initialState","reducers","setMessage","state","action","payload","setPostedMessage","push","deleteMessage","filter","message","_id","editMessage","map","fetchMessages","dispatch","fetch","then","res","json","console","log","children","length","replies","root","nestedMessages","forEach","Object","assign","parentId","actions","postMessages","author","accessToken","localStorage","getItem","setLoading","method","body","JSON","stringify","headers","Authorization","catch","deleteMessages","id","userId","statusCode","setErrorMessage","editMessages","newValue","updatedMessage"],"mappings":"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","sourcesContent":["import { createSlice } from '@reduxjs/toolkit'\nimport { ui } from 'reducers/ui'\n\nexport const messages = createSlice({\n  name: 'messages',\n  initialState: {\n    messages: [],\n  },\n  reducers: {\n    setMessage: (state, action) => {\n      state.messages = action.payload\n    },\n    setPostedMessage: (state, action) => {\n      // state.messages = action.payload\n      state.messages.push(action.payload)\n    },\n    deleteMessage: (state, action) => {\n      // Filter out all message but the message with matching id\n      state.messages = state.messages.filter(message => message._id !== action.payload)\n    },\n    editMessage: (state, action) => {\n      // To find the message we want to update (message data = action.payload)\n      // If message found, return the message with updated data\n      state.messages = state.messages.map((message) => {\n        if (message._id === action.payload._id) {\n          return action.payload\n        } else {\n          // Otherwhise return message as is\n          return message\n        }\n      })\n    },\n  }\n})\n\n\n//GET MESSAGES\nexport const fetchMessages = () => {\n  return dispatch => {\n    // dispatch(ui.actions.setLoading(true))\n    fetch('http://localhost:8080/messages')\n      .then((res) => res.json())\n      .then((json) => {\n        console.log(json)\n        if (json.children.length > 0) {\n          const replies = function (json, root) {\n            const nestedMessages = {};\n            json.forEach(message => {\n              Object.assign(nestedMessages[message._id] = nestedMessages[message._id] || {}, message);\n              nestedMessages[message.parentId] = nestedMessages[message.parentId] || {};\n              nestedMessages[message.parentId].children = nestedMessages[message.parentId].children || [];\n              nestedMessages[message.parentId].children.push(nestedMessages[message._id]);\n            });\n            return nestedMessages[root].children;\n          }(json, null);\n          dispatch(messages.actions.setMessage(replies));\n          // dispatch(ui.actions.setLoading(false))\n          console.log(\"Array with children\", replies)\n        } else {\n          dispatch(messages.actions.setMessage(json));\n          // dispatch(ui.actions.setLoading(false))\n        }\n      });\n  };\n};\n\n\n//POST MESSAGES\nexport const postMessages = ({ message, author, parentId }) => {\n  return dispatch => {\n    const accessToken = localStorage.getItem('accessToken')\n    dispatch(ui.actions.setLoading(true))\n    fetch(\"http://localhost:8080/messages\", {\n      method: \"POST\",\n      body: JSON.stringify({ message, author, parentId }),\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: accessToken\n      }\n    })\n      .then(res => res.json())\n      .then((json) => {\n        console.log(\"author\", author)\n        console.log(\"json post\", json)\n        dispatch(messages.actions.setPostedMessage(json));\n        // dispatch(messages.actions.setMessage(json));\n        dispatch(ui.actions.setLoading(false))\n      })\n      .catch(() => {\n        console.log(\"Failed to post message\")\n      })\n  }\n};\n// //POST MESSAGES\n// export const postMessages = ({ message, author, parentId }) => {\n//   return dispatch => {\n//     const accessToken = localStorage.getItem('accessToken')\n//     // dispatch(ui.actions.setLoading(true))\n//     fetch(\"http://localhost:8080/messages\", {\n//       method: \"POST\",\n//       body: JSON.stringify({ message, author, parentId }),\n//       headers: {\n//         \"Content-Type\": \"application/json\",\n//         Authorization: accessToken\n//       }\n//     })\n//       .then(res => {\n//         console.log(\"author\", author)\n//         dispatch(messages.actions.setPostedMessage(message, author, parentId));\n//         // dispatch(messages.actions.setMessage(message));\n//         dispatch(ui.actions.setLoading(false))\n//       })\n//       .catch(() => {\n//         console.log(\"Failed to post message\")\n//       })\n//   }\n// };\n\n// DELETE MESSAGE\nexport const deleteMessages = ({ id, author }) => {\n  return dispatch => {\n    dispatch(ui.actions.setLoading(true))\n    const accessToken = localStorage.getItem('accessToken')\n    const userId = localStorage.getItem('userId')\n\n    fetch(`http://localhost:8080/messages/${id}`, {\n      method: 'DELETE',\n      statusCode: 204,\n      body: JSON.stringify({ id, author, userId }),\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: accessToken\n      }\n    })\n      .then(() => {\n        if (author === userId) {\n          dispatch(messages.actions.deleteMessage(id))\n          dispatch(ui.actions.setLoading(false))\n          dispatch(ui.actions.setErrorMessage(false))\n        } else {\n          console.log(\"not your message\")\n          dispatch(ui.actions.setLoading(false))\n          dispatch(ui.actions.setErrorMessage(true))\n        }\n      })\n  }\n}\n\n//EDIT MESSAGE\nexport const editMessages = ({ id, author, newValue }) => {\n  return dispatch => {\n    dispatch(ui.actions.setLoading(true))\n    const accessToken = localStorage.getItem('accessToken')\n    const userId = localStorage.getItem('userId')\n    fetch(`http://localhost:8080/messages/${id}`, {\n      method: 'PUT',\n      body: JSON.stringify({ message: newValue, userId: userId, author: author }),\n      headers: {\n        'Content-Type': 'application/json',\n        Authorization: accessToken\n      }\n    })\n      .then((res) => res.json())\n      .then((updatedMessage) => {\n        console.log(\"2\", updatedMessage)\n        dispatch(messages.actions.editMessage(updatedMessage))\n        dispatch(ui.actions.setLoading(false))\n      })\n  }\n}"]},"metadata":{},"sourceType":"module"}